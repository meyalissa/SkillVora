<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Suggested Careers</title>

    <link rel="stylesheet" href="../css/suggest.css" />

    <link
      href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined"
      rel="stylesheet"
    />
    
    <!-- Material Symbols -->
    <link
      href="https://fonts.googleapis.com/css2?family=Material+Symbols+Rounded"
      rel="stylesheet"
    />
    <!-- Career data -->
    <script src="../js/careerData.js"></script>
  </head>

  <body>
    <!-- ===== HEADER ===== -->
    <header>
      <!-- LEFT SIDE -->
      <div class="header-left">
        <div class="logo">
          <a href="../index.html">
            <img src="../assets/logo.png" class="nav_img_logo" id="siteLogo" alt="SkillVora Logo">
          </a>
        </div>
      </div>

      <!-- RIGHT SIDE -->
      <div style="display:flex; align-items:center; gap:1.25rem;">
        <a href="../CheckResume/resume-checker.html" class="btn outline small">
          Resume Checker
        </a>

        <div class="theme-toggle">
          <img id="themeIcon" src="../assets/sun_line.png" alt="Toggle theme">
        </div>
      </div>
    </header>

    <!-- CONTENT -->
    <div class="container">
    <div class="page-header">
        <button
          class="back-btn"
          onclick="window.location.href='user-type.html'"
        >
        <span class="material-symbols-outlined back-icon">arrow_back</span>
        Explore Again
        </button>


        <h2 id="pageTitle">Suggested Careers</h2>
      </div>

      <div class="careers-grid" id="careersGrid"></div>
    </div>

    <script>
      /* =========================
         GET USER SELECTION
      ========================== */
      function getUserSelection() {
        return {
          userType: localStorage.getItem("userType"), // SPM Leavers | Job Seeker
          interest: localStorage.getItem("interest"),
          background: localStorage.getItem("background"),
          skills: JSON.parse(localStorage.getItem("skills")) || [],
        };
      }

      /* =========================
         SCORE CAREERS
      ========================== */
      function scoreCareers() {
        const user = getUserSelection();

        return careerData.map((career) => {
          let score = 0;

          if (career.interests.includes(user.interest)) score += 3;
          if (career.backgrounds.includes(user.background)) score += 2;

          user.skills.forEach((skill) => {
            if (career.skills.includes(skill)) score += 1;
          });

          return { ...career, score };
        });
      }

      /* =========================
        RENDER REQUIREMENTS
      ========================== */
      function renderRequirements(career, userType) {
        /* ---- SPM LEAVERS ---- */
        if (userType === "SPM Leavers" && career.spm) {
          const req = career.spm;
          return `
            <div class="requirements">
              <h4>SPM Requirements</h4>
              <p><strong>Minimum Qualification:</strong> ${req.education}</p>
              <ul class="subjects">
                ${req.subjects
                  .map(sub => `
                    <li>
                      <span class="subject-name">${sub.name}</span>
                      <span class="subject-grade">${sub.grade}</span>
                    </li>`).join("")}
              </ul>
              <p class="notes">${req.notes}</p>
            </div>
          `;
        }

        /* ---- JOB SEEKERS ---- */
        if (career.jobSeeker) {
          const jobReq = career.jobSeeker;
          // Show only first 2 courses
          const limitedCourses = jobReq.courses.slice(0, 2);

          return `
            <div class="requirements">
              <h4>Career Requirements</h4>
              <p><strong>Minimum Qualification:</strong> ${jobReq.education}</p>
              <p><strong>Recommended Course(s):</strong></p>
              <ul class="subjects">
                ${limitedCourses.map(course => `<li>${course}</li>`).join("")}
              </ul>
              <p class="notes">${jobReq.notes}</p>
              <p class="view-full"><em>View full recommended courses in the Career Information page</em></p>
            </div>
          `;
        }

        return "";
      }

      /* =========================
         DISPLAY CAREERS
      ========================== */
      function displayCareers() {
        const grid = document.getElementById("careersGrid");
        const pageTitle = document.getElementById("pageTitle");
        const user = getUserSelection();

        const careers = scoreCareers()
          .filter((career) => career.score > 0)
          .sort((a, b) => b.score - a.score); // SHOW ALL

        grid.innerHTML = "";

        if (careers.length === 0) {
          grid.innerHTML = "<p>No careers match your selection.</p>";
          return;
        }

        careers.forEach((career) => {
          const card = document.createElement("div");
          card.className = "career-card";

          card.innerHTML = `
            <div class="career-icon">
              <img src="${career.image}" alt="${career.title}" />
            </div>

            <h3 class="career-title">${career.title}</h3>
            <p class="career-description">${career.description}</p>

            <div class="skills">
              ${career.skills
                .map((skill) => `<span class="skill-tag">${skill}</span>`)
                .join("")}
            </div>

            ${renderRequirements(career, user.userType)}

            <button class="view-details-btn">View Details</button>
          `;

          card
            .querySelector(".view-details-btn")
            .addEventListener("click", () => {
              localStorage.setItem(
                "selectedCareer",
                JSON.stringify(career)
              );
              window.location.href = "career-information.html";
            });

          grid.appendChild(card);
        });
      }

      document.addEventListener("DOMContentLoaded", displayCareers);
    </script>
  </body>
       <script src="../js/theme-toggle.js"></script>
</html>
